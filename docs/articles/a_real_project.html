<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2.2 A Real Project • rave</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2.2 A Real Project">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rave</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5.51</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a_real_project.html">2.2 A Real Project</a>
    </li>
    <li>
      <a href="../articles/build_your_first_module.html">2.1 Step-by-step, Build Your First RAVE Module</a>
    </li>
    <li>
      <a href="../articles/create_inputs.html">2.3 Create RAVE Inputs</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>2.2 A Real Project</h1>
                        <h4 class="author">Vignette Author</h4>
            
            <h4 class="date">2019-10-13</h4>
      
      
      <div class="hidden name"><code>a_real_project.Rmd</code></div>

    </div>

    
    
<p>In this section, we will go through RAVE module structure. During the previous section, we created a package <code>firstPkg</code>. If you check the project folder in your file system, you’ll find the following structure:</p>
<pre><code>. (firstPkg, package root directory)
+-- R/
|   +-- aaa.R
|   +-- ...
|
+-- inst/
|   +-- tools/
|   |   +-- ...
|   |
|   +-- modules/
|   |   +-- firstPkg_first_example/
|   |       +-- ...
|   |   
|   +-- rave.yaml
|   
|   +-- DESCRIPTION
|   +-- NAMESPACE
|   +-- firstPkg.Rproj
|   +-- ...</code></pre>
<p>Here are some critical files/folders</p>
<ul>
<li>
<code>DESCRIPTION</code> contains basic descriptive information about the package;</li>
<li>
<code>NAMESPACE</code> controls which function to be imported from/exported to other packages;</li>
<li>
<code>R</code> folder contains all your functions that can be re-used by others;</li>
<li>
<code>inst</code> contains RAVE module and developer toolbox;</li>
<li>
<code>firstPkg.Rproj</code> is RStudio project file.</li>
</ul>
<p>It’s quite boring if I start by telling the usage and definition of these files. I guess most of you would probably skip this section if I do so. Therefore I decide to come up with a “real” but simple “project” that uses the real data. By implementing the “project”, you’ll probably begin to understand the functional designs of a RAVE module.</p>
<div id="a-real-but-simple-module" class="section level2">
<h2 class="hasAnchor">
<a href="#a-real-but-simple-module" class="anchor"></a>A Real but Simple Module</h2>
<p>Let’s implemet a module that takes a single <code>electrode</code>, one <code>frequency</code>, one <code>time_range</code> as inputs.</p>
<p>The outputs will be: 1. <code>text_result</code>: prints the input values 2. <code>table_result</code>: summarizes subject basic information in a table.</p>
</div>
<div id="add-ui-components" class="section level2">
<h2 class="hasAnchor">
<a href="#add-ui-components" class="anchor"></a>Add UI Components</h2>
<div id="to-start-lets-open-instmodulesfirstpkg_first_examplecomp-r-" class="section level4">
<h4 class="hasAnchor">
<a href="#to-start-lets-open-instmodulesfirstpkg_first_examplecomp-r-" class="anchor"></a>1. To start, let’s open <code>inst/modules/firstPkg_first_example/comp.R</code>.</h4>
<p>If you are using different module ID, the path will be <code>inst/modules/[YOUR MODULE ID]/comp.R</code>.</p>
</div>
<div id="run-the-line-4-11-basically" class="section level4">
<h4 class="hasAnchor">
<a href="#run-the-line-4-11-basically" class="anchor"></a>2. Run the line 4-11, basically</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(firstPkg)</a>
<a class="sourceLine" id="cb2-2" title="2">env =<span class="st"> </span><span class="kw">dev_firstPkg</span>(T)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">mount_demo_subject</span>()</a></code></pre></div>
<p>The first line imports your package <code>firstPkg</code>.</p>
<p>The second line loads RAVE developer toolbox. It contains functions that helps you define input, output, preview module, or even fast-reload the package.</p>
<p>The third line mount a demo subject for development. This step is important for developing RAVE modules offline (without launching UI).</p>
</div>
<div id="define-inputs" class="section level3">
<h3 class="hasAnchor">
<a href="#define-inputs" class="anchor"></a>Define Inputs</h3>
<p>There are three inputs:</p>
<ul>
<li>electrode: selective input</li>
<li>frequency: numeric, single number</li>
<li>time_range: numeric, interval</li>
</ul>
<div id="go-to-inputs-part--you-can-use-the-bottom-left-button-to-navigate-to-this-part-or-just-cmdctrlf-to-search-for-inputs-" class="section level4">
<h4 class="hasAnchor">
<a href="#go-to-inputs-part--you-can-use-the-bottom-left-button-to-navigate-to-this-part-or-just-cmdctrlf-to-search-for-inputs-" class="anchor"></a>1. Go to “Inputs” part. You can use the bottom-left button to navigate to this part, or just <code>cmd/ctrl+f</code> to search for “Inputs”.</h4>
<div class="figure">
<img src="src/2_11_comp_structure.png" alt="Use editor navigator to find the input part."><p class="caption">Use editor navigator to find the input part.</p>
</div>
</div>
<div id="replace-the-existing-code-in-inputs-part-with-the-following-code" class="section level4">
<h4 class="hasAnchor">
<a href="#replace-the-existing-code-in-inputs-part-with-the-following-code" class="anchor"></a>2. Replace the existing code in “Inputs” part with the following code:</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">define_input_single_electrode</span>(<span class="dt">inputId =</span> <span class="st">'electrode'</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">define_input_frequency</span>(<span class="dt">inputId =</span> <span class="st">'frequency'</span>, <span class="dt">is_range =</span> <span class="ot">FALSE</span>, <span class="dt">initial_value =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">define_input_time</span>(<span class="dt">inputId =</span> <span class="st">'time_range'</span>, <span class="dt">is_range =</span> <span class="ot">TRUE</span>, <span class="dt">initial_value =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p>These three lines define the inputs.</p>
<ul>
<li>
<code>define_input_single_electrode</code> is an input for one single electrode</li>
<li>
<code>define_input_frequency</code> defines a frequency input, <code>is_range=FALSE</code> means the input value will be a number</li>
<li>
<code>define_input_time</code> defines a time input, <code>is_range=TRUE</code> means the input value will be an interval</li>
</ul>
<p><code>inputId</code> will be the variable name of the corresponding input, for example, if user select the <span class="math inline">\(14^{th}\)</span> electrode, then you have <code>electrode="14"</code>.</p>
<div class="figure">
<img src="src/2_13_input_value.png" alt="Variable electrode will be initialized as the first electrode loaded once initialized."><p class="caption">Variable <code>electrode</code> will be initialized as the first electrode loaded once initialized.</p>
</div>
<p>If you get lost about what I’m talking about, don’t worry. We will come back in the next section and introduce all kinds of inputs.</p>
</div>
<div id="preview-inputs" class="section level4">
<h4 class="hasAnchor">
<a href="#preview-inputs" class="anchor"></a>3. Preview Inputs</h4>
<p>Run code <code>view_layout(YOUR MODULE ID)</code> to preview the result:</p>
<pre><code>view_layout('firstPkg_first_example')</code></pre>
<p>If you are going alright, you will see the following result:</p>
<div class="figure">
<img src="src/2_12_input_preview.png" alt="Preview after adding inputs"><p class="caption">Preview after adding inputs</p>
</div>
</div>
</div>
<div id="define-output" class="section level3">
<h3 class="hasAnchor">
<a href="#define-output" class="anchor"></a>Define Output</h3>
<div id="still-in-the-same-file-instmodulesyour-module-idcomp-r-go-to-outputs-part-" class="section level4">
<h4 class="hasAnchor">
<a href="#still-in-the-same-file-instmodulesyour-module-idcomp-r-go-to-outputs-part-" class="anchor"></a>1. Still in the same file <code>inst/modules/[YOUR MODULE ID]/comp.R</code>, go to “Outputs” part.</h4>
<p>You can use the bottom-left button to navigate to this part, or just <code>cmd/ctrl+f</code> to search for “Outputs”.</p>
</div>
<div id="you-will-see-the-output-text_result-is-already-defined" class="section level4">
<h4 class="hasAnchor">
<a href="#you-will-see-the-output-text_result-is-already-defined" class="anchor"></a>2. You will see the output <code>text_result</code> is already defined:</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">define_output</span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">definition =</span> <span class="kw">verbatimTextOutput</span>(<span class="st">'text_result'</span>),</a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">title =</span> <span class="st">'This Output Shows all the Printed Results'</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">width =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="dt">order =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-6" title="6">)</a></code></pre></div>
<ul>
<li>This part of code defines a <code>verbatimTextOutput</code>, which displays the printed results “as-is” to the output.</li>
<li>The meaning of <code>title</code> is straightforward.</li>
<li>
<code>width</code> defines the output width from 1 (8.3%) to 12 (100%). It uses <a href="https://getbootstrap.com/docs/4.0/layout/grid/#responsive-classes">Bootstrap CSS</a> grid system. Basically the output region is devided to 12 equally spaced columns, and <code>width</code> mean how many columns to be used by the output.</li>
<li>
<code>order</code> is a number indicating the order of outputs if there are multiple ones.</li>
</ul>
</div>
<div id="define-output-table_result" class="section level4">
<h4 class="hasAnchor">
<a href="#define-output-table_result" class="anchor"></a>3. Define output <code>table_result</code>
</h4>
<p><strong>Append</strong> the following code to the existing output definition:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">define_output</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">definition =</span> <span class="kw">tableOutput</span>(<span class="st">'table_result'</span>),</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">title =</span> <span class="st">'Subject Summary'</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">width =</span> <span class="dv">12</span>,</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">order =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb6-6" title="6">)</a></code></pre></div>
</div>
<div id="preview-inputs-1" class="section level4">
<h4 class="hasAnchor">
<a href="#preview-inputs-1" class="anchor"></a>4. Preview Inputs</h4>
<p>Run code <code>view_layout(YOUR MODULE ID)</code> again to preview the result:</p>
<pre><code>view_layout('firstPkg_first_example')</code></pre>
<p>If you are going alright, you will see the following result:</p>
<div class="figure">
<img src="src/2_12_output_preview.png" alt="Preview after adding both inputs and outputs"><p class="caption">Preview after adding both inputs and outputs</p>
</div>
<p>You might have noticed two errors. The first one is printed directly in the UI</p>
<div class="err">
<blockquote>
<p><strong>Error:</strong> object ‘table_result’ not found</p>
</blockquote>
</div>
<p>The other one is printed in RStudio console:</p>
<blockquote>
<p>[ ERROR ]: <span class="err">[firstPkg_first_example] object ‘text_electrode’ not found parse_selections(text_electrode)</span></p>
</blockquote>
<p>Don’t be panic seeing these errors. They appear because RAVE found your output components, but it can’t find correct handlers (functions) to generate outputs. This is completely reasonable and we will fix this problem in the next part.</p>
</div>
</div>
</div>
<div id="main-module-part-and-output-handlers" class="section level2">
<h2 class="hasAnchor">
<a href="#main-module-part-and-output-handlers" class="anchor"></a>Main Module Part, and output handlers</h2>
<p>Now you have UIs for inputs and outputs, it’s time to decide how to collect all the information you need and how to generate outputs.</p>
<div id="collect-everything-you-need-for-outputs---main-r" class="section level3">
<h3 class="hasAnchor">
<a href="#collect-everything-you-need-for-outputs---main-r" class="anchor"></a>Collect Everything You Need for Outputs - main.R</h3>
<p>For <code>table_result</code>, users might want to see</p>
<ul>
<li>Subject ID</li>
<li>Number of trials</li>
<li>Range of frequencies vs. actual loaded frequencies</li>
<li>Number of time points selected</li>
<li>Total number of electrodes vs. actual loaded electrodes</li>
</ul>
<p>We need to collect these data first to generate outputs.</p>
<div id="open-instmodulesfirstpkg_first_examplemain-r" class="section level4">
<h4 class="hasAnchor">
<a href="#open-instmodulesfirstpkg_first_examplemain-r" class="anchor"></a>1. Open <code>inst/modules/firstPkg_first_example/main.R</code>
</h4>
<p>This file defines what kind of data to collect for the output. Let’s say you have a statistical model, you probably want to fit the model here and wrap up the results so that all the outputs handlers can get access to the model results.</p>
<p>The first thing is to initialize the module. Run the line to enable offline debugging. It will execute code between “start” and “end” anchors in <code>comp.R</code> to initialize inputs.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">init_module</span>(<span class="st">'firstPkg_first_example'</span>, <span class="dt">debug =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt; frequency &lt;-  0  </span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&gt; time_range &lt;-  0 1  </span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&gt; electrode &lt;-  14 </span></a></code></pre></div>
</div>
<div id="between-start-and-end-paste-the-following-lines" class="section level4">
<h4 class="hasAnchor">
<a href="#between-start-and-end-paste-the-following-lines" class="anchor"></a>2. Between <code># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Start</code> and <code># &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; End</code>, paste the following lines:</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Start ------------- [DO NOT EDIT THIS LINE] ---------------------</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">######' @auto=TRUE</span></a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co"># Get subject ID</span></a>
<a class="sourceLine" id="cb9-5" title="5">subject_id =<span class="st"> </span>subject<span class="op">$</span>id</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co"># Get actual loaded time</span></a>
<a class="sourceLine" id="cb9-8" title="8">time_points =<span class="st"> </span>preload_info<span class="op">$</span>time_points</a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co"># Get actual loaded frequencies</span></a>
<a class="sourceLine" id="cb9-11" title="11">frequencies =<span class="st"> </span>preload_info<span class="op">$</span>frequencies</a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co"># Get trial information</span></a>
<a class="sourceLine" id="cb9-14" title="14">trial =<span class="st"> </span>module_tools<span class="op">$</span><span class="kw">get_meta</span>(<span class="st">'trials'</span>)</a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co"># Get all the frequencies this subject has</span></a>
<a class="sourceLine" id="cb9-17" title="17">all_freq =<span class="st"> </span>module_tools<span class="op">$</span><span class="kw">get_meta</span>(<span class="st">'frequencies'</span>); all_freq =<span class="st"> </span>all_freq<span class="op">$</span>Frequency</a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co"># Get all valid electrodes for this subject</span></a>
<a class="sourceLine" id="cb9-20" title="20">all_elec =<span class="st"> </span>subject<span class="op">$</span>valid_electrodes</a>
<a class="sourceLine" id="cb9-21" title="21"></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co"># Obtain user selected electrode</span></a>
<a class="sourceLine" id="cb9-23" title="23">requested_electrode =<span class="st"> </span><span class="kw"><a href="../reference/parse_selections.html">parse_selections</a></span>(electrode)</a>
<a class="sourceLine" id="cb9-24" title="24"></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co"># Obtain the nearest frequency </span></a>
<a class="sourceLine" id="cb9-26" title="26">nearest_frequency =<span class="st"> </span>frequencies[<span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(frequencies <span class="op">-</span><span class="st"> </span>frequency))]</a>
<a class="sourceLine" id="cb9-27" title="27"></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co"># Obtain the time points selected</span></a>
<a class="sourceLine" id="cb9-29" title="29">requested_time_range =<span class="st"> </span>time_points[time_points <span class="op">%within%</span><span class="st"> </span>time_range]</a>
<a class="sourceLine" id="cb9-30" title="30"></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(time_range)</a>
<a class="sourceLine" id="cb9-32" title="32"><span class="co"># &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; End ----------------- [DO NOT EDIT THIS LINE] -------------------</span></a></code></pre></div>
<p>Now we have all the information needed for outputs. You might ask how to debug the code and how RAVE handle the code.</p>
<p>For the first question, simply run the code above to seek for errors.</p>
<p>For the second question, RAVE has already inserted a hidden function to your package called <code>debug_module</code>. You can use <code>firstPkg:::debug_module</code> to call the function (noticing there are three <code>:</code>). <code>:::</code> is usually used to extract hidden functions in packages, ** use it for debug only **.</p>
<p>You might want to run:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">main =<span class="st"> </span>firstPkg<span class="op">:::</span><span class="kw">debug_module</span>(<span class="st">'firstPkg_first_example'</span>)</a></code></pre></div>
<p>Function <code>debug_module</code> does the following things:</p>
<ol style="list-style-type: decimal">
<li>Reload package, all changes will take effect. It will stop for major syntax errors</li>
<li>Check all the dependencies and load them</li>
<li>Expose all the package functions to you for debug use</li>
<li>Check and load demo subject if no subject is loaded</li>
<li>Parse all UI components in <code>comp.R</code> and wrap up <code>main.R</code> as one function</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/formals.html">formals</a></span>(main)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">#&gt; $frequency</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; $time_range</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; [1] 0 1</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; $electrode</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; [1] "14"</span></a></code></pre></div>
<p>If you check the arguments of function <code>main</code>, you will find this function takes in arguments that are defined in <code>comp.R</code>. You can use the default values, or try different choices to change the input values.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">ret =<span class="st"> </span><span class="kw">main</span>(<span class="dt">time_range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; [1] 0 2</span></a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4">ret =<span class="st"> </span><span class="kw">main</span>(time_range)</a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; [1] 0 1</span></a></code></pre></div>
<p>The return <code>ret</code> contains three elements: one <code>results</code> and two outputs.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(ret)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">#&gt; [1] "results"      "table_result" "text_result" </span></a></code></pre></div>
<p>Right now, we haven’t implemented output handlers, hence the two outputs will run into errors. However, we can use <code>results</code> to create handlers.</p>
</div>
</div>
<div id="write-your-output-handlers-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#write-your-output-handlers-functions" class="anchor"></a>Write Your Output Handlers (Functions)</h3>
<p>An output handler is a function whose name is exactly the same as its outputId. Remember in the last section, we added function in <code>R/results.R</code>? That’s one output handler. We need to edit this file again to add proper handlers in this case.</p>
<p>Open <code>R/results.R</code> first.</p>
<div id="modify-the-first-output-text_result" class="section level4">
<h4 class="hasAnchor">
<a href="#modify-the-first-output-text_result" class="anchor"></a>1. Modify the First Output <code>text_result</code>
</h4>
<p>In the previous section, we added function <code>text_result</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">text_result &lt;-<span class="st"> </span><span class="cf">function</span>(result){</a>
<a class="sourceLine" id="cb14-2" title="2">  ...</a>
<a class="sourceLine" id="cb14-3" title="3">}</a></code></pre></div>
<p>Now we need to modify this function to print all the input variables “as-is” to the output UI.</p>
<p>First, run <code>result &lt;- ret$results</code> in your console.</p>
<p>edit function <code>text_result</code>, as follows:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">text_result &lt;-<span class="st"> </span><span class="cf">function</span>(result){</a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"Electrode Selected:"</span>, result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'electrode'</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"Frequency Selected:"</span>, result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'frequency'</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"Time Range Selected:"</span>, result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'time_range'</span>), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb15-5" title="5">}</a></code></pre></div>
<p>By using <code>result$get_value</code>, you can obtain any variables declared in your main.R as well as input variables.</p>
</div>
<div id="add-the-output-table_result" class="section level4">
<h4 class="hasAnchor">
<a href="#add-the-output-table_result" class="anchor"></a>2. Add the Output <code>table_result</code>
</h4>
<p>Add the following function to <code>R/results.R</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">table_result &lt;-<span class="st"> </span><span class="cf">function</span>(result){</a>
<a class="sourceLine" id="cb16-2" title="2">  subject_id =<span class="st"> </span>result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'subject_id'</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">  </a>
<a class="sourceLine" id="cb16-4" title="4">  n_trials =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'subject_id'</span>))</a>
<a class="sourceLine" id="cb16-5" title="5">  </a>
<a class="sourceLine" id="cb16-6" title="6">  all_freq =<span class="st"> </span>result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'all_freq'</span>)</a>
<a class="sourceLine" id="cb16-7" title="7">  frequencies =<span class="st"> </span>result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'frequencies'</span>)</a>
<a class="sourceLine" id="cb16-8" title="8">  </a>
<a class="sourceLine" id="cb16-9" title="9">  n_timepoints =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'time_points'</span>))</a>
<a class="sourceLine" id="cb16-10" title="10">  </a>
<a class="sourceLine" id="cb16-11" title="11">  all_elec =<span class="st"> </span>result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'all_elec'</span>)</a>
<a class="sourceLine" id="cb16-12" title="12">  requested_electrode =<span class="st"> </span>result<span class="op">$</span><span class="kw">get_value</span>(<span class="st">'requested_electrode'</span>)</a>
<a class="sourceLine" id="cb16-13" title="13">  </a>
<a class="sourceLine" id="cb16-14" title="14">  tbl =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb16-15" title="15">    <span class="st">'Subject ID'</span> =<span class="st"> </span>subject_id,</a>
<a class="sourceLine" id="cb16-16" title="16">    <span class="st">'# of Trials'</span> =<span class="st"> </span>n_trials,</a>
<a class="sourceLine" id="cb16-17" title="17">    <span class="st">'Frequencies Loaded'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(frequencies), <span class="dt">collapse =</span> <span class="st">' - '</span>),</a>
<a class="sourceLine" id="cb16-18" title="18">    <span class="st">'Available Frequencies'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(all_freq), <span class="dt">collapse =</span> <span class="st">' - '</span>),</a>
<a class="sourceLine" id="cb16-19" title="19">    <span class="st">'Time Points Selected'</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(n_timepoints),</a>
<a class="sourceLine" id="cb16-20" title="20">    <span class="st">'Electrodes Selected'</span> =<span class="st"> </span><span class="kw"><a href="../reference/deparse_selections.html">deparse_selections</a></span>(requested_electrode),</a>
<a class="sourceLine" id="cb16-21" title="21">    <span class="st">'Electrodes Total'</span> =<span class="st"> </span><span class="kw"><a href="../reference/deparse_selections.html">deparse_selections</a></span>(all_elec)</a>
<a class="sourceLine" id="cb16-22" title="22">  )</a>
<a class="sourceLine" id="cb16-23" title="23">  </a>
<a class="sourceLine" id="cb16-24" title="24">  <span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb16-25" title="25">    <span class="dt">Name =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(tbl),</a>
<a class="sourceLine" id="cb16-26" title="26">    <span class="dt">Value =</span> tbl</a>
<a class="sourceLine" id="cb16-27" title="27">  )</a>
<a class="sourceLine" id="cb16-28" title="28">}</a></code></pre></div>
<p>We get variables from <code>result</code> and generate summary table.</p>
</div>
<div id="preview" class="section level4">
<h4 class="hasAnchor">
<a href="#preview" class="anchor"></a>Preview</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">view_layout</span>(<span class="st">'firstPkg_first_example'</span>)</a></code></pre></div>
<div class="figure">
<img src="src/2_14_project_preview.png" alt="Project Preview"><p class="caption">Project Preview</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#a-real-but-simple-module">A Real but Simple Module</a></li>
      <li><a href="#add-ui-components">Add UI Components</a></li>
      <li><a href="#main-module-part-and-output-handlers">Main Module Part, and output handlers</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zhengjia Wang, John Magnotti, Michael S. Beauchamp, Beauchamp lab.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
